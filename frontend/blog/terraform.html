<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migrating to Terraform: Remote State & OIDC | Jen Magruder</title>
    <meta name="description" content="How I migrated my cloud resume infrastructure to Terraform with zero downtime, implementing remote state and OIDC authentication.">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Blog post specific styles */
        .blog-post {
            max-width: 800px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }
        
        .blog-header {
            margin-bottom: 3rem;
        }
        
        .blog-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .blog-post-meta {
            display: flex;
            gap: 2rem;
            color: var(--secondary-color);
            font-size: 0.95rem;
            margin-bottom: 2rem;
        }
        
        .blog-post-meta i {
            color: #81D8D0;
            margin-right: 0.5rem;
        }
        
        .blog-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-color);
        }
        
        .blog-content h2 {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            text-align: left;
        }
        
        .blog-content h3 {
            font-size: 1.4rem;
            color: var(--secondary-color);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        
        .blog-content p {
            margin-bottom: 1.5rem;
        }
        
        .blog-content ul, .blog-content ol {
            margin-bottom: 1.5rem;
            padding-left: 2rem;
        }
        
        .blog-content li {
            margin-bottom: 0.5rem;
        }
        
        .blog-content code {
            background: var(--background-color);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #81D8D0;
        }
        
        .blog-content pre {
            background: var(--primary-color);
            color: white;
            padding: 1.5rem;
            border-radius: 4px;
            overflow-x: auto;
            margin-bottom: 1.5rem;
        }
        
        .blog-content pre code {
            background: none;
            color: white;
            padding: 0;
        }
        
        .blog-content strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .blog-content em {
            color: #81D8D0;
            font-style: italic;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #81D8D0;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            gap: 0.75rem;
        }
        
        .back-link i {
            transition: transform 0.3s ease;
        }
        
        .back-link:hover i {
            transform: translateX(-3px);
        }
        
        @media (max-width: 768px) {
            .blog-post {
                padding: 2rem 1rem;
            }
            
            .blog-title {
                font-size: 2rem;
            }
            
            .blog-content {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <article class="blog-post">
        <a href="../index.html#blog" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Portfolio
        </a>
        
        <header class="blog-header">
            <h1 class="blog-title">Migrating My Cloud Resume to Terraform: Remote State, OIDC, and Zero Downtime</h1>
            <div class="blog-post-meta">
                <span><i class="far fa-calendar"></i>December 2025</span>
                <span><i class="far fa-clock"></i>8 min read</span>
                <span><i class="fas fa-tag"></i>Infrastructure as Code</span>
            </div>
        </header>
        
        <div class="blog-content">
            <p>When I joined the Cloud Resume Challenge cohort in December 2025, the requirement was CLI instead of clicking through the AWS Console. I'd already built my cloud resume manually through the Console. I asked Andrew Brown if I could migrate my existing infrastructure to Terraform instead. He said yes.</p>
            
            <p>Problem: I couldn't tear it all down and start over.</p>
            
            <h2>The Constraint</h2>
            
            <p>My cloud resume was live and working. S3 hosting, CloudFront CDN, Lambda visitor counter, DynamoDB, API Gateway, custom domain. Everything built manually in the Console.</p>
            
            <p>But I was actively job searching. Recruiters were visiting it. My visitor counter was past 300. It was linked in LinkedIn posts and job applications.</p>
            
            <p>Tearing it down meant broken links in applications, dead portfolio URLs, lost visitor data, and potential downtime.</p>
            
            <p>So: import existing resources into Terraform. Zero downtime migration.</p>
            
            <h2>The Import Process</h2>
            
            <p>Importing AWS resources into Terraform sounds simple. Write the config to match existing infrastructure, run <code>terraform import</code>, done.</p>
            
            <p>Reality was messier.</p>
            
            <h3>Problem 1: CloudFront Logging ACL</h3>
            
            <p>First attempt:</p>
            
            <pre><code>Error: Error putting S3 bucket ACL: InvalidArgument: S3 bucket does not enable ACL access
  status code: 400</code></pre>
            
            <p>CloudFront logging needed ACL permissions to write logs to my S3 bucket. But my security settings had <code>IgnorePublicAcls = true</code>. These two requirements fought each other.</p>
            
            <p>Fix: Configure bucket ownership controls in Terraform first, then enable ACLs for CloudFront logging.</p>
            
            <p>Lesson: AWS security defaults sometimes conflict with service requirements.</p>
            
            <h3>Problem 2: IAM Role Import Path</h3>
            
            <p>Importing my Lambda execution role failed. IAM role ARNs include a path like <code>/service-role/</code>, but <code>terraform import</code> expects only the role name.</p>
            
            <p>Fix: Use just the role name in the import command, but include the full path in the Terraform config to match the existing resource.</p>
            
            <p>Lesson: ARN paths and resource names are different things.</p>
            
            <h3>Problem 3: S3 ACL Ordering</h3>
            
            <p>After fixing CloudFront logs, I tried setting the ACL in Terraform and got another error. Modern S3 buckets disable ACLs by default. To enable them, you need bucket ownership controls configured first.</p>
            
            <p>Fix: Use <code>depends_on</code> to make sure ownership controls apply before setting ACLs.</p>
            
            <p>Lesson: S3 ACL configuration requires specific ordering.</p>
            
            <h2>Remote State: Why I Needed It</h2>
            
            <p>At this point, everything worked with local Terraform state. I could run <code>terraform plan</code> and <code>terraform apply</code> from my laptop.</p>
            
            <p>Then someone in Discord mentioned OIDC and remote state. I started reading and realized: keeping state local wasn't great.</p>
            
            <p>My PC had broken twice this year. Just got it back, and it's already broken again. I'm using my laptop now, but the thought of my Terraform state only existing on one machine that could break? Not ideal.</p>
            
            <p>Remote state in S3 meant: encrypted storage, work from anywhere, won't lose everything if hardware fails.</p>
            
            <h3>Setting Up Remote State</h3>
            
            <p>Problem: I needed an S3 bucket to store state. But I was using Terraform to create S3 buckets. How do I create the bucket that stores the state for creating buckets?</p>
            
            <p>Solution: Two steps. Create remote state infrastructure (S3 bucket and DynamoDB table) using local state. Then migrate local state to S3.</p>
            
            <h3>DynamoDB State Locking</h3>
            
            <p>S3 stores the state, but what prevents two processes from modifying infrastructure simultaneously?</p>
            
            <p>DynamoDB state locking. When Terraform runs, it acquires a lock in DynamoDB. If another process tries to run, it sees the lock and waits. Prevents state corruption.</p>
            
            <p>Cost: Essentially free. DynamoDB charges about $0.000001 per operation. For 10 Terraform runs per month, that's nothing.</p>
            
            <h2>OIDC: No More Stored Credentials</h2>
            
            <p>My GitHub Actions workflow used AWS access keys stored in GitHub Secrets. It worked fine. But the same Discord conversation mentioned OIDC as more secure.</p>
            
            <h3>Why OIDC</h3>
            
            <p>Access keys are long lived credentials that sit in GitHub Secrets. If GitHub got compromised, those keys would be exposed until I manually rotated them.</p>
            
            <p>OIDC was different. No stored credentials. GitHub Actions requests temporary credentials for each workflow run. They expire after an hour. If something went wrong, credentials would be useless almost immediately.</p>
            
            <p>Setup took longer than access keys, but worth it.</p>
            
            <h3>Repository Restriction</h3>
            
            <p>When I set up the OIDC provider in AWS, I created an IAM role that GitHub Actions could assume. Critical part: restrict it to ONLY my specific repository. Without that, any GitHub repository could potentially authenticate to my AWS account.</p>
            
            <p>I also scoped IAM permissions tightly. The role can only affect resources in my cloud resume project. If GitHub Actions got compromised, it couldn't touch anything else. Limited blast radius.</p>
            
            <h2>What I Learned</h2>
            
            <p>Importing saved my live infrastructure. Destroying and recreating would have been cleaner, but my site was live and linked in job applications. Worth the extra complexity.</p>
            
            <p>Remote state made things safer. My PC broke twice this year. Moving state to S3 meant I wouldn't lose everything if hardware failed. Plus encryption, state locking, and ability to work from any machine.</p>
            
            <p>Discord taught me the important stuff. Both remote state and OIDC came from Discord conversations. Community helped me figure out what actually mattered.</p>
            
            <p>OIDC was worth the setup time. Access keys would have been faster, but no long lived credentials in GitHub Secrets was the right call.</p>
            
            <p>Scoping IAM permissions mattered. I could have used wildcard permissions and been done faster, but limiting to only cloud resume resources meant less damage if something went wrong.</p>
            
            <h2>What's Next</h2>
            
            <p>With the migration complete, I can showcase production grade infrastructure as code in job applications. Everything is version controlled, reviewable, and reproducible.</p>
            
            <p>AWS Solutions Architect certification exam: January 16, 2026.</p>
            
            <h2>Update</h2>
            
            <p>I received Lieutenant Commander grade (really experienced) from the Cloud Resume Challenge cohort review. The migration from Console to Terraform with remote state and OIDC demonstrated production-level infrastructure as code skills.</p>
            
            <hr style="margin: 3rem 0; border: none; border-top: 1px solid var(--border-color);">
            
            <p><strong>Want to see the code?</strong> Check out my <a href="https://github.com/JenMagruder/cloud-resume-challenge" target="_blank" style="color: #81D8D0;">GitHub repository</a> for the complete Terraform configuration.</p>
            
            <p><strong>Connect with me on <a href="https://www.linkedin.com/in/jennifer-magruder" target="_blank" style="color: #81D8D0;">LinkedIn</a></strong> if you're working on similar cloud projects.</p>
        </div>
        
        <a href="../index.html#blog" class="back-link" style="margin-top: 3rem;">
            <i class="fas fa-arrow-left"></i> Back to Portfolio
        </a>
    </article>
</body>
</html>